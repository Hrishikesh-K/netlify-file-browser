self.addEventListener("install",()=>{self.skipWaiting()}),self.addEventListener("activate",a=>{a.waitUntil(self.clients.claim())});const map=new Map;function createStream(a){return new ReadableStream({start(b){a.onmessage=({data:a})=>{if("end"===a)return b.close();if("abort"===a){b.error("Aborted the download");return}b.enqueue(a)}},cancel(b){console.log("user aborted",b),a.postMessage({abort:!0})}})}self.onmessage=a=>{if("ping"===a.data)return;let b=a.data,e=b.url||self.registration.scope+Math.random()+"/"+("string"==typeof b?b:b.filename),d=a.ports[0],c=new Array(3);c[1]=b,c[2]=d,a.data.readableStream?c[0]=a.data.readableStream:a.data.transferringReadable?d.onmessage=a=>{d.onmessage=null,c[0]=a.data.readableStream}:c[0]=createStream(d),map.set(e,c),d.postMessage({download:e})},self.onfetch=e=>{let f=e.request.url;if(f.endsWith("/ping"))return e.respondWith(new Response("pong"));let g=map.get(f);if(!g)return null;let[h,a,i]=g;map.delete(f);let b=new Headers({"Content-Type":"application/octet-stream; charset=utf-8","Content-Security-Policy":"default-src 'none'","X-Content-Security-Policy":"default-src 'none'","X-WebKit-CSP":"default-src 'none'","X-XSS-Protection":"1; mode=block"}),c=new Headers(a.headers||{});c.has("Content-Length")&&b.set("Content-Length",c.get("Content-Length")),c.has("Content-Disposition")&&b.set("Content-Disposition",c.get("Content-Disposition")),a.size&&(console.warn("Depricated"),b.set("Content-Length",a.size));let d="string"==typeof a?a:a.filename;d&&(console.warn("Depricated"),d=encodeURIComponent(d).replace(/['()]/g,escape).replace(/\*/g,"%2A"),b.set("Content-Disposition","attachment; filename*=UTF-8''"+d)),e.respondWith(new Response(h,{headers:b})),i.postMessage({debug:"Download started"})}